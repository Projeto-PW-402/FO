"use strict";(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[594],{7762:function(t,e,o){o.r(e),o.d(e,{default:function(){return f}});var s=function(){var t=this,e=t._self._c;return e("div",[e("Header"),e("div",{staticClass:"container mt-5 mb-5"},[e("h2",{staticClass:"mb-4"},[t._v("Submissões de Ocorrências")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6"},[e("b-form",{staticClass:"form-card",on:{submit:function(e){return e.preventDefault(),t.submitOccurrence.apply(null,arguments)}}},[e("b-form-group",{staticClass:"mb-4 text-start",attrs:{label:"Título*","label-for":"title"}},[e("b-form-input",{staticClass:"form-control",attrs:{id:"title",required:"",placeholder:"Ex: Veículo mal estacionado"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("b-form-group",{staticClass:"mb-4 text-start",attrs:{label:"Tipo de Ocorrência*"}},[e("b-form-select",{staticClass:"form-select",attrs:{options:t.occurrenceTypes,required:""},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),e("b-form-group",{staticClass:"mb-4 text-start",attrs:{label:"Descrição*"}},[e("b-form-textarea",{staticClass:"form-control",attrs:{rows:"4",required:"",placeholder:"Escreva a sua descrição aqui..."},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),e("div",{staticClass:"mb-4 text-start"},[e("label",{staticClass:"form-label"},[t._v("Fotografias")]),e("div",{staticClass:"photo-container d-flex justify-content-start gap-3"},[t._l(t.form.photos,(function(o,s){return e("div",{key:s,staticClass:"photo-placeholder text-center",on:{click:function(e){return t.triggerPhotoInput(s)}}},[o?e("img",{staticClass:"photo-preview",attrs:{src:o,alt:"Foto"}}):e("span",{staticClass:"text-muted"},[t._v("+")])])})),e("input",{ref:"photoInput",staticClass:"d-none",attrs:{type:"file",accept:"image/*",multiple:""},on:{change:t.handlePhotoUpload}})],2)]),e("div",{staticClass:"mb-4 text-start"},[e("label",{staticClass:"form-label",attrs:{for:"ficheiros"}},[t._v("Ficheiros (máx: 5)")]),e("div",{staticClass:"d-flex align-items-center"},[e("button",{staticClass:"btn btn-custom-file me-2",attrs:{type:"button"},on:{click:function(e){return t.$refs.fileInput.click()}}},[t._v(" Escolher Ficheiros ")]),e("input",{ref:"fileInput",staticClass:"form-control d-none",attrs:{type:"file",id:"ficheiros",multiple:""},on:{change:t.updateFileName}}),e("span",{staticClass:"text-muted"},[t._v(t._s(t.fileLabel))])]),t.form.files.length?e("ul",{staticClass:"file-list mt-2"},t._l(t.form.files,(function(o,s){return e("li",{key:s},[t._v(" "+t._s(o.name)+" ")])})),0):t._e()]),e("div",{staticClass:"mb-4 text-start"},[e("label",{staticClass:"form-label"},[t._v("Dados Pessoais*")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.fullName,expression:"form.fullName"}],staticClass:"form-control mb-2",attrs:{type:"text",placeholder:"Nome Completo"},domProps:{value:t.form.fullName},on:{input:function(e){e.target.composing||t.$set(t.form,"fullName",e.target.value)}}})]),e("div",{staticClass:"col-md-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.nif,expression:"form.nif"}],staticClass:"form-control mb-2",attrs:{type:"text",placeholder:"NIF"},domProps:{value:t.form.nif},on:{input:function(e){e.target.composing||t.$set(t.form,"nif",e.target.value)}}})]),e("div",{staticClass:"col-md-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.contact,expression:"form.contact"}],staticClass:"form-control mb-2",attrs:{type:"telphone",placeholder:"Contacto"},domProps:{value:t.form.contact},on:{input:function(e){e.target.composing||t.$set(t.form,"contact",e.target.value)}}})]),e("div",{staticClass:"col-md-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.email,expression:"form.email"}],staticClass:"form-control mb-2",attrs:{type:"email",placeholder:"E-mail"},domProps:{value:t.form.email},on:{input:function(e){e.target.composing||t.$set(t.form,"email",e.target.value)}}})])])]),e("div",{staticClass:"mb-4 form-check custom-form-check"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.termsAccepted,expression:"form.termsAccepted"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"termosCondicoes",required:""},domProps:{checked:Array.isArray(t.form.termsAccepted)?t._i(t.form.termsAccepted,null)>-1:t.form.termsAccepted},on:{change:function(e){var o=t.form.termsAccepted,s=e.target,a=!!s.checked;if(Array.isArray(o)){var i=null,r=t._i(o,i);s.checked?r<0&&t.$set(t.form,"termsAccepted",o.concat([i])):r>-1&&t.$set(t.form,"termsAccepted",o.slice(0,r).concat(o.slice(r+1)))}else t.$set(t.form,"termsAccepted",a)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"termosCondicoes"}},[t._v(" Li e aceito os termos e condições da Política de Privacidade* ")])]),e("b-button",{staticClass:"btn btn-custom",attrs:{type:"submit"}},[e("b-icon",{staticClass:"mr-2",attrs:{icon:"check-circle"}}),t._v(" Enviar ")],1)],1)],1),e("div",{staticClass:"col-md-6 d-flex flex-column"},[e("div",{staticClass:"map-placeholder"},[e("div",{ref:"mapOverview",staticClass:"map-overview"})]),e("b-form-group",{staticClass:"location-field",attrs:{label:"Localização no Mapa"}},[e("b-form-input",{staticClass:"form-control",attrs:{readonly:"",placeholder:"Clique no mapa para selecionar"},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})],1)],1)])]),e("Footer")],1)},a=[],i=(o(6573),o(8100),o(7936),o(8111),o(7588),o(1701),o(7467),o(4732),o(9577),o(4979),o(2394)),r=o(3987),l=o(4373);l.A.defaults.baseURL="http://localhost:5000";var c={name:"Ocorrencias",components:{Header:r.A,Footer:i.A},data(){return{form:{id:null,title:"",lat:null,lng:null,address:"",type:null,description:"",status:"open",createdAt:null,fullName:"",nif:"",contact:"",email:"",files:[],photos:Array(6).fill(null),termsAccepted:!1},occurrenceTypes:[{value:"bad_parking",text:"Veículo mal-estacionado"},{value:"reserved_spots",text:"Ocupação indevida de lugares reservados"},{value:"congestion",text:"Congestionamento"},{value:"other",text:"Outros"}],overviewMap:null,overviewMarker:null,fileLabel:"Nenhum ficheiro selecionado",currentPhotoIndex:null,latitude:"",longitude:""}},mounted(){this.initMaps(),this.loadSavedData()},methods:{initMaps(){this.overviewMap=new google.maps.Map(this.$refs.mapOverview,{center:{lat:39.3999,lng:-8.2245},zoom:6.6,disableDefaultUI:!0}),this.overviewMap.addListener("click",(t=>{this.setLocation(t.latLng),this.geocodeLocation(t.latLng)}))},setLocation(t){this.form.lat=t.lat(),this.form.lng=t.lng(),this.overviewMarker?(this.overviewMarker.setPosition(t),this.latitude=t.lat(),this.longitude=t.lat(),console.log(this.latitude,this.longitude)):(this.overviewMarker=new google.maps.Marker({map:this.overviewMap,position:t,draggable:!0}),this.overviewMarker.addListener("dragend",(e=>{this.latitude=t.lat(),this.longitude=t.lat(),this.geocodeLocation(e.latLng)}))),this.latitude=t.lat(),this.longitude=t.lng(),this.overviewMap.setCenter(t),this.overviewMap.setZoom(12)},geocodeLocation(t){const e=new google.maps.Geocoder;e.geocode({location:t},((t,e)=>{"OK"===e&&t[0]&&(this.form.address=t[0].formatted_address)}))},triggerPhotoInput(t){this.currentPhotoIndex=t,this.$refs.photoInput.click()},handlePhotoUpload(t){const e=t.target.files[0];if(e){const t=new FileReader;t.onload=t=>{this.$set(this.form.photos,this.currentPhotoIndex,t.target.result)},t.readAsDataURL(e)}},updateFileName(t){const e=t.target;e.files.length>0?(this.form.files=Array.from(e.files),this.fileLabel=`${e.files.length} ficheiro(s) selecionado(s)`):(this.form.files=[],this.fileLabel="Nenhum ficheiro selecionado")},loadSavedData(){const t=localStorage.getItem("savedPhotos");t&&(this.form.photos=JSON.parse(t));const e=localStorage.getItem("savedFiles");if(e){const t=JSON.parse(e);this.form.files=t.map((t=>new File([],t.name))),this.fileLabel=`${t.length} ficheiro(s) selecionado(s)`}},updateFileName(t){const e=t.target;e.files.length>0?(this.form.files=Array.from(e.files),this.fileLabel=`${e.files.length} ficheiro(s) selecionado(s)`):(this.form.files=[],this.fileLabel="Nenhum ficheiro selecionado")},async submitOccurrence(){if(!this.form.lat||!this.form.lng)return void alert("Por favor, clique no mapa para selecionar uma localização.");const t=new FormData;t.append("json_data",JSON.stringify({nome:this.form.title,tipo:this.form.type,descricao:this.form.description,dnome:this.form.fullName,dnif:this.form.nif,dcontacto:this.form.contact,demail:this.form.email,location:this.form.address,lat:this.latitude,lng:this.longitude})),this.form.photos.forEach(((e,o)=>{if(e&&e.startsWith("data:")){const s=this.dataURLtoBlob(e);t.append(`photo_${o}`,s,`photo_${o}.jpg`)}})),this.form.files.forEach(((e,o)=>{t.append(`file_${o}`,e)}));try{const e=await l.A.post("/auditoria/upload",t,{headers:{"Content-Type":"multipart/form-data"}});alert("Ocorrência registrada com sucesso!"),console.log(e.data),this.resetForm()}catch(e){console.error("Erro ao registrar ocorrência:",e),alert("Erro ao registrar ocorrência")}},resetForm(){this.form={title:"",type:null,description:"",photos:Array(6).fill(null),files:[],fullName:"",nif:"",contact:"",email:"",address:"",lat:null,lng:null,termsAccepted:!1},this.$refs.fileInput&&(this.$refs.fileInput.value=null),this.$refs.photoInput&&(this.$refs.photoInput.value=null),this.overviewMarker&&(this.overviewMarker.setMap(null),this.overviewMarker=null),this.overviewMap&&(this.overviewMap.setCenter({lat:39.3999,lng:-8.2245}),this.overviewMap.setZoom(6.6))},dataURLtoBlob(t){const e=atob(t.split(",")[1]),o=t.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(e.length),a=new Uint8Array(s);for(let i=0;i<e.length;i++)a[i]=e.charCodeAt(i);return new Blob([a],{type:o})}}},n=c,m=o(1656),d=(0,m.A)(n,s,a,!1,null,"c8a0d5c8",null),f=d.exports}}]);
//# sourceMappingURL=about.74aee251.js.map